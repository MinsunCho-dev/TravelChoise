<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>경북/대구/울산 | 여행어때</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="shortcut icon" href="../static/img/favicon.ico">
  <link rel="stylesheet" type="text/css" href="../static/css/common.css">
  <link rel="stylesheet" type="text/css" href="../static/css/train.css">
  
</head>

<body>
  <div class="banner2">
    <img src="../static/img/avatar2.png" alt="">
  </div>
  <div class=" banner">
    <span style="width: 100px; height: 20; color: white; font-weight: bold;">겨울에도</span>
    <a href="http://localhost:8000/" class="logo" title="여행어때">여행어때</a>
    <a href="http://localhost:8000/post/view_post" class="community">커뮤니티</a>
    <a href="http://localhost:8000/search" class="search">여행지 리스트</a>
    <a href="http://localhost:8000/worldCup" class="worldCup">여행지 월드컵</a>
    <a href="http://localhost:8000/user/login" class="login">로그인</a>
    <a class="logout">로그아웃</a>
  </div>

  <div class="snowflakes" aria-hidden="true">
    <div class="snowflake">❅</div>
    <div class="snowflake">❅</div>
    <div class="snowflake">❆</div>
    <div class="snowflake">❄</div>
    <div class="snowflake">❅</div>
    <div class="snowflake">❆</div>
    <div class="snowflake">❄</div>
    <div class="snowflake">❆</div>
    <div class="snowflake">❆</div>
    <div class="snowflake">❄</div>
  </div>

  <div class="div-padding"></div>

  <button class="train-btn" onclick="showList(this);" value="inputDep">출발지 선택</button>
  <button class="train-btn" onclick="showList(this);" value="inputArr">도착지 선택</button>

  <div id="regionlist" style="text-align: center; display: none;"> class에 inputDep
    <button class="train-btn" id="region" type="button" value="11" onclick="showStation(this)">서울특별시</button>
    <button class="train-btn" id="region" type="button" value="23" onclick="showStation(this)">인천광역시</button>
    <button class="train-btn" id="region" type="button" value="31" onclick="showStation(this)">경기도</button>
    <button class="train-btn" id="region" type="button" value="32" onclick="showStation(this)">강원도</button>
    <br>
    <button class="train-btn" id="region" type="button" value="25" onclick="showStation(this)">대전광역시</button>
    <button class="train-btn" id="region" type="button" value="12" onclick="showStation(this)">세종특별시</button>
    <button class="train-btn" id="region" type="button" value="33" onclick="showStation(this)">충청북도</button>
    <button class="train-btn" id="region" type="button" value="34" onclick="showStation(this)">충청남도</button>
    <br>
    <button class="train-btn" id="region" type="button" value="26" onclick="showStation(this)">울산광역시</button>
    <button class="train-btn" id="region" type="button" value="24" onclick="showStation(this)">광주광역시</button>
    <button class="train-btn" id="region" type="button" value="35" onclick="showStation(this)">전라북도</button>
    <button class="train-btn" id="region" type="button" value="36" onclick="showStation(this)">전라남도</button>
    <br>
    <button class="train-btn" id="region" type="button" value="21" onclick="showStation(this)">부산광역시</button>
    <button class="train-btn" id="region" type="button" value="22" onclick="showStation(this)">대구광역시</button>
    <button class="train-btn" id="region" type="button" value="37" onclick="showStation(this)">경상북도</button>
    <button class="train-btn" id="region" type="button" value="38" onclick="showStation(this)">경상남도</button>
  </div>

  <div id="station"><span>Staion List</span></div>
  <!-- 역 항목 박스임 안에 꾸며줘야함 station list 살릴 방법도 찾기 -->

  <div id="arrstation" ><span>도착지</span></div>
  <form action="" style="text-align: center;">
    출발지코드:<input type="text" id="start" onclick="">
    도착지코드:<input type="text" id="end" onclick="">
    출발시간:<input type="text" id="time" onclick="">  
  </form>
  <button onclick="searchTrain()">검색</button>
  <div id="result"></div>

  <script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
    crossorigin="anonymous"></script>
  <script>

    function showList(obj){
      var regionlist = document.getElementById("regionlist");
      regionlist.style.display = "block";
      regionlist.name = obj.value;
    }
    
    function showStation(obj){
      //역리스트 초기화
      var station = document.getElementById("station");
      station.style.display = "block";
      station.innerText = "";
      
      var xhr = new XMLHttpRequest();
      var url = 'http://apis.data.go.kr/1613000/TrainInfoService/getCtyAcctoTrainSttnList'; /*URL*/
      var queryParams = '?' + encodeURIComponent('serviceKey') + '='+'iwTiqJHCRqEIdoWj%2F4g58Sj89y5bOUhHGhMZPRwH5CBPJOyxUiTArkIf0k1ah%2BUm2N%2BMJ3jGziROL2wUBo%2BuGg%3D%3D'; /*Service Key*/
      queryParams += '&' + encodeURIComponent('pageNo') + '=' + encodeURIComponent('1'); /**/
      queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('100'); /**/
      queryParams += '&' + encodeURIComponent('_type') + '=' + encodeURIComponent('xml'); /**/
      queryParams += '&' + encodeURIComponent('cityCode') + '=' + encodeURIComponent(obj.value); /**/
      xhr.open('GET', url + queryParams);
      xhr.onreadystatechange = function () {
          if (this.readyState == 4) {
              console.log('Status: '+this.status+'nHeaders: '+JSON.stringify(this.getAllResponseHeaders())+'nBody: '+this.responseText);
              var xml = xhr.responseXML;

              var st_code = xml.getElementsByTagName("nodeid");
              var st_name = xml.getElementsByTagName("nodename");

              for(let i = 0; i < 100; i++) {
               var a = st_code[i].firstChild.nodeValue;
               var b = st_name[i].firstChild.nodeValue;

              //역 버튼 생성
              var regionlist = document.getElementById("regionlist");
              // console.log(regionlist.name);
              if( regionlist.name == "inputDep")
              {
              var station = document.getElementById("station");
              var btn = document.createElement("button");
              btn.innerText = b;
              btn.id = a;
              btn.className = "train-btn";
              btn.value = a;
              btn.setAttribute("onClick", "inputStn(this)");
              
              station.appendChild(btn);
              }

              else if (regionlist.name == "inputArr"){var station = document.getElementById("station");
              var btn = document.createElement("button");
              btn.innerText = b;
              btn.id = a;
              btn.className = "train-btn";
              btn.value = a;              
              btn.setAttribute("onClick", "inputStn(this)");
              
              station.appendChild(btn);
              }
            }
          }
        };
      xhr.send('');
    }
    
    function inputStn(obj) {
      var stn_code = obj.value;
      var regionlist = document.getElementById("regionlist");
      if( regionlist.name == "inputDep")

      {var start = document.getElementById("start");
      start.value = stn_code;
      var station = document.getElementById("station");
      regionlist.style.display = "none";
      station.style.display = "none";
      regionlist.name = "";
    }

      else{var end = document.getElementById("end");
      end.value = stn_code;
      var station = document.getElementById("station");
      regionlist.style.display = "none";
      station.style.display = "none";
      regionlist.name = "";
    }
    
    }

function searchTrain(){
  var departure = document.getElementById('start');
  var arrival = document.getElementById('end');
  var time = document.getElementById('time');
  var result = document.getElementById("result");

  var train_code = ['00','01','02','03','04','05','06','07','08','09','10','16','17']
  
  for(var i = 1; i <14; i ++){

  var xhr = new XMLHttpRequest();
var url = 'http://apis.data.go.kr/1613000/TrainInfoService/getStrtpntAlocFndTrainInfo'; /*URL*/
var queryParams = '?' + encodeURIComponent('serviceKey') + '='+'iwTiqJHCRqEIdoWj%2F4g58Sj89y5bOUhHGhMZPRwH5CBPJOyxUiTArkIf0k1ah%2BUm2N%2BMJ3jGziROL2wUBo%2BuGg%3D%3D'; /*Service Key*/
queryParams += '&' + encodeURIComponent('pageNo') + '=' + encodeURIComponent('1'); /**/
queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('10'); /**/
queryParams += '&' + encodeURIComponent('_type') + '=' + encodeURIComponent('json'); /**/
queryParams += '&' + encodeURIComponent('depPlaceId') + '=' + encodeURIComponent(departure.value); /**/
queryParams += '&' + encodeURIComponent('arrPlaceId') + '=' + encodeURIComponent(arrival.value); /**/
queryParams += '&' + encodeURIComponent('depPlandTime') + '=' + encodeURIComponent(time.value); /**/
queryParams += '&' + encodeURIComponent('trainGradeCode') + '=' + encodeURIComponent(train_code[i]); /**/
xhr.open('GET', url + queryParams);
xhr.onreadystatechange = function () {
    if (this.readyState == 4) {
        
        //add로 바꿔서 
        var a = 
          'Status: '+this.status+'nHeaders: '+JSON.stringify(this.getAllResponseHeaders())+'nBody: '+this.responseText;
          console.log('Status: '+this.status+'nHeaders: '+JSON.stringify(this.getAllResponseHeaders())+'nBody: '+this.responseText);
        var list = result.innerHTML
          result.innerHTML = result.innerHTML+a;
        }
};


xhr.send('');
  }
}
  </script>
</body>

</html>